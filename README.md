# WooCommerce Avito XML Generator

WordPress плагин для автоматической генерации XML-фида товаров WooCommerce для размещения на Avito.

## Описание

Плагин интегрируется с WooCommerce и позволяет экспортировать товары в XML формате, совместимом с требованиями Avito. Поддерживает гибкую настройку полей, шаблоны описаний с плейсхолдерами и автоматическую генерацию по расписанию.

## Основные возможности

- ✅ **Динамическая система полей** - настраиваемые поля для товаров и категорий
- ✅ **Контроль экспорта на уровне категорий** - выбирайте какие категории экспортировать
- ✅ **Система плейсхолдеров** - используйте данные товаров в шаблонах
- ✅ **Автоматическая генерация XML** - настраиваемое расписание через WP Cron
- ✅ **Поддержка изображений** - автоматический экспорт до 10 изображений
- ✅ **Приоритет цен** - использует цены распродажи, если установлены
- ✅ **Логирование** - отслеживание процесса генерации

## Требования

- WordPress 5.0 или выше
- WooCommerce 3.0 или выше
- PHP 7.0 или выше

## Установка

1. Скачайте или клонируйте репозиторий в папку `wp-content/plugins/`
2. Активируйте плагин через меню "Плагины" в WordPress
3. Перейдите в **WooCommerce → Avito Export** для настройки

## Настройка

### 1. Настройка полей XML

Перейдите в **WooCommerce → Поля XML** для настройки полей:

- **Глобальные поля** - одинаковые значения для всех объявлений
- **Поля категорий** - настройки на уровне категорий товаров
- **Поля товаров** - индивидуальные поля для каждого товара

### 2. Включение экспорта категорий

1. Откройте **Товары → Категории**
2. Отредактируйте нужную категорию
3. Отметьте **"Экспорт на Avito"** в блоке "Настройки Avito"
4. Настройте шаблон заголовка и дополнительные поля

### 3. Автоматическая генерация

В разделе **WooCommerce → Avito Export**:

- Включите автоматическую генерацию XML
- Выберите интервал (ежедневно, два раза в день, еженедельно)
- Настройте уведомления об ошибках

## Плейсхолдеры

Используйте плейсхолдеры в значениях полей:

### Стандартные поля товара
- `{product_name}` - название товара
- `{product_sku}` - артикул
- `{product_price}` - текущая цена
- `{product_regular_price}` - обычная цена
- `{product_sale_price}` - цена со скидкой
- `{product_description}` - полное описание
- `{product_short_description}` - краткое описание
- `{category_name}` - название категории

### Произвольные поля
- `{meta:field_name}` - произвольное поле товара
- `{term_meta:field_name}` - произвольное поле категории
- `{attribute:attribute_name}` - атрибут товара

## Структура XML

Генерируемый XML соответствует требованиям Avito:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Ads formatVersion="3" target="Avito.ru">
    <Ad>
        <Id>SKU123</Id>
        <Title>Название товара</Title>
        <Description><![CDATA[Описание товара]]></Description>
        <Price>5990</Price>
        <Images>
            <Image url="https://example.com/image1.jpg"/>
        </Images>
        <!-- Дополнительные поля -->
    </Ad>
</Ads>
```

## Структура плагина

```
wc-avito/
├── avito-uralgips.php          # Основной файл плагина
├── uninstall.php               # Очистка данных при удалении
└── includes/
    ├── admin-menu.php          # Страница настроек
    ├── field-settings-page.php # Настройка полей XML
    ├── xml-generator.php       # Генерация XML
    ├── xml-generator-dynamic.php # Динамические поля в XML
    ├── field-manager.php       # Управление настройками полей
    ├── category-export-field.php # Поля категорий
    ├── dynamic-category-fields.php # Динамические поля категорий
    ├── dynamic-product-fields.php # Динамические поля товаров
    ├── product-fields.php      # Статические поля товаров
    ├── product-export-field.php # Контроль экспорта товаров
    └── cron.php                # Автоматическая генерация
```

## Использование

### Ручная генерация XML

1. Перейдите в **WooCommerce → Avito Export**
2. Нажмите **"Сгенерировать XML"**
3. Скачайте сгенерированный файл по ссылке

### Автоматическая генерация

После настройки расписания XML будет генерироваться автоматически. Файл доступен по адресу:
```
https://your-site.com/wp-content/uploads/avito_products.xml
```

## Логика экспорта

Товар экспортируется если:
- ✅ Статус публикации: "Опубликован"
- ✅ Товар принадлежит хотя бы одной категории с включенным экспортом
- ✅ У товара установлена цена больше 0

## Удаление плагина

При удалении через WordPress автоматически удаляются:
- Все поля товаров (post_meta)
- Все поля категорий (term_meta)
- Настройки плагина (options)
- Задачи Cron
- Сгенерированные XML файлы

## История изменений

### Последние обновления
- ✅ Удалена зависимость от ACF
- ✅ Убрана генерация CSV (только XML)
- ✅ Удалены алгоритмы автоматической генерации описаний
- ✅ Полностью динамическая система полей
- ✅ Контроль экспорта через категории
- ✅ Система плейсхолдеров для шаблонов
- ✅ Проверки на пустые значения полей

## Поддержка

При возникновении проблем:
1. Проверьте логи генерации в разделе настроек
2. Убедитесь что у категорий включен экспорт
3. Проверьте что у товаров заполнены обязательные поля

## Лицензия

Этот плагин разработан для внутреннего использования.

## Автор

Разработано для Uralgips Izhevsk
